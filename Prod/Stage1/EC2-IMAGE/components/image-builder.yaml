name: ImageBuilder-AnsibleWeb
description: Build Image using Ansible
schemaVersion: 1.0

phases:
  - name: build
    steps:
      - name: update_and_install
        action: ExecuteBash
        inputs:
          commands:
            - dnf -y update
            - dnf -y install ansible python3 git

      - name: clone_and_run_playbook
        action: ExecuteBash
        inputs:
          commands:
            # Clone your repo (adjust if repo name is different)
            - git clone https://github.com/rootacces77/terraform-project1 /tmp/terraform-project1

            # Go into the Ansible directory and run playbook locally on this instance
            - cd /tmp/terraform-project1/ec2-webserver-ansible
            - ansible-playbook playbooks/main.yml

      - name: cleanup
        action: ExecuteBash
        inputs:
          commands:
            - dnf -y remove ansible git
            - rm -rf /tmp/terraform-project1